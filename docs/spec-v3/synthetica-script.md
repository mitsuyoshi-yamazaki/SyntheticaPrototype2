## 概要

Synthetica Scriptは、COMPUTERが実行するプログラムを記述するプログラミング言語の総称である。
COMPUTERが実行するのはCOMPUTERのメモリに格納されたバイト列を命令セットとして解釈したもので、本ファイルではこの命令セットと、命令セットを人間が記述するためのアセンブリ言語の仕様を策定する。
今後のバージョンでは、アセンブリ言語をラップして構造化プログラミングの仕組みを導入したC言語コンパイラと、GUIベースプログラミングを追加する予定である。どちらもアセンブリ言語を経由して命令セットへ変換される。

## アーキテクチャ仕様

COMPUTERのアーキテクチャ仕様について
COMPUTERは以下の機能を持つ

- プログラムカウンタ
  - プログラムカウンタは8bitの変数である
    - これによりメモリの最大容量が定まる（2^8 = 256）
    - メモリ容量の最大値は256に固定される
  - 次に実行する命令のメモリ番地を示す
  - プログラムカウンタを操作する命令以外では、命令を実行したらプログラムカウンタを1進める
    - メモリの最後尾にある命令を実行した後は、プログラムカウンタはメモリの先頭を指す
- ワーキングレジスタ
  - TODO: ワーキングレジスタのbit数を決定する
- フラグ
  - キャリフラグ
  - ゼロフラグ
  - TODO: 他に必要なフラグはあるか
- メモリ領域
  - TODO: メモリの各領域を何bitとするか
  - メモリ容量の最大値は 2^8 = 256
- 外部バス
  - TODO: 回路的に接続しているユニットへアクセスするためのもの
  - アクセス制御：複数COMPUTERが同じユニットにアクセスする場合、そのtickで最後に更新された状態をとる
- 動作周波数
  - COMPUTERの動作周波数は分数を取りうる（例：1命令/3tick）
  - 分数周波数の処理：各tickでCOMPUTERユニットがそのtickで何回命令を実行できるかを管理
  - 例：1/3周波数のCOMPUTERは、3tickのうち2tickは命令を実行しない（エネルギー消費もない）
- 備考
  - 割り込み機能は持たない
    - ソフトウェアの自由度や創発性に対して大きな利点があることがわかれば将来追加する
  - セキュリティ・安全性：意図しない動作やメモリ内容の破損は進化の原動力となるため、積極的な対策は行わない
  - 無限ループ：無限ループに陥ったCOMPUTERは単にそのエージェントに不利に働くのみで、アプリケーションへの追加負荷はない

一般的に利用されているCPUと異なり、COMPUTERにはプログラムとデータの区別がない。
プログラムとデータを分離したプログラミングをしたい場合は、プログラム的にデータ領域の実行を禁止する。

## アセンブラ言語仕様

- メモリ上の情報がプログラムとして読み込まれる際は、32bitを8bitずつに分けて、先頭からオペコード（命令）、オペランド1, オペランド2, オペランド3として解釈される

### 命令一覧

- TODO: 命令の一覧を定義する。定義するうえでの制約は以下
  - 初期化状態（値は0）はNOP命令と解釈される。NOPは実行されても何も行わないが、プログラムカウンタを1進める

### COMPUTERの生成について

- COMPUTERは唯一自律動作するユニットである。生成が完了した次のtickから動作を始めるが、生成直後はプログラムカウンタ、ワーキングレジスタ、フラグ、メモリの全ての値は0である
  - その状態（NOP命令のみがメモリに入っている）でCOMPUTERが動作しても何も行わない（メモリの最後までNOP命令を実行したら、またメモリの先頭へ戻って実行）
  - 生成したCOMPUTERに意味のある仕事を行わせたい場合、先頭にループを書き込んでおき、そのループを実行している間にメモリに内容を書き込み、最後にその先頭ループを削除（NOPで上書き）する、という手順でメモリの書き込みを行うことができる
- メモリ書き込み中の動作：ゲーム世界の内部実行は直列であるため、同じtickでCOMPUTER実行中に別のCOMPUTERからメモリを書き換えられた場合も、単に処理の前後関係があるだけである（処理順序は後に決定）

## TODO項目

### 1. 基本仕様の詳細化
- TODO: ワーキングレジスタのbit数を決定する
- TODO: 他に必要なフラグはあるか
- TODO: メモリの各領域を何bitとするか
- TODO: 外部バスの通信プロトコル（読み取り/書き込み方式、データ形式、エラーハンドリング）
- TODO: 命令実行時のエネルギー消費量の定義（命令種別ごとのエネルギーコスト、消費失敗時の挙動）

### 2. 命令長とメモリアドレッシングの整合性
- TODO: 命令が32bit（オペコード8bit + オペランド24bit）とメモリアドレス8bitの関係を明確化
- TODO: 1命令で4メモリ領域を消費する場合の実質的な命令数制限（64個）への対応

### 3. 命令セット設計
- TODO: 命令の一覧を定義する
  - 基本演算（加減乗除、論理演算）
  - 制御構造（条件分岐、ループ）
  - 外部アクセス（ユニット操作、メモリ間接参照）
  - システム（停止、リセット）
- TODO: 3つのオペランドの用途分類（即値、レジスタ、メモリアドレス等の区別）

### 4. エラー処理とデバッグ支援
- TODO: 不正命令、メモリ範囲外アクセス等のエラー処理の挙動定義
- TODO: デバッグ用の実行トレース機能の必要性検討

### 5. 外部ユニット連携
- TODO: 他ユニットとの通信方法の詳細定義
- TODO: COMPUTERから他ユニットへのアクション予約方法

### 6. メモリ書き込み機構との整合性
- TODO: 外部書き換え許可状態での初期化手順の詳細化（analysis-report.md案Bとの整合性）
- TODO: 書き込み競合時の挙動、部分書き込み時の状態管理
