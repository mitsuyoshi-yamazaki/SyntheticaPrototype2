# spec-v3 課題・TODOリスト

## 概要

このファイルは、Synthetica仕様v3.0.0に関する未解決の課題とTODO項目を管理します。

## 記載方法

- 「一覧」の項に、すべての課題とTODOをチェックボックス形式で記載する
- 完了した項目はチェックを入れる（`- [x]`）
- 詳細な説明が必要な項目のみ、その項目名を見出しとして「詳細」の項に記載する
- 詳細がある項目は末尾に 📝 を付けて表示する
- 一行で説明が完結する項目は、一覧での記載のみで完了とする
- 優先度に応じて自由に並べ替え可能

## 一覧

- v3仕様 📝
  - [x] DISASSEMBLERの（一時）廃止 📝
  - [x] 各ユニットのスペックを読み出す操作メモリ領域を追加する
  - [x] Synthetica C記法の検討する 📝
  - [x] 現在の時刻を取得する命令が必要か検討する 📝
  - [x] 万能複製実現のための追加命令の実装（advanced-instructions-proposal.md参照）
  - [x] v3.0.0準拠の自己複製エージェント実装例の作成 📝
  - [x] v3.1.0準拠の自己複製エージェント実装例の作成 📝
  - [x] エネルギー確保順序とアクション実行順序の決定 📝
  - [x] ビット演算を活用した効率的な実装方法の文書化 📝
  - [ ] エネルギーソースの実装仕様 📝
  - [ ] 熱拡散システムの詳細定義 📝
  - [ ] 移動システムの実装詳細 📝
  - [ ] 物理演算の詳細仕様化（衝突・反発力） 📝
  - [ ] エネルギーオブジェクトの物理仕様 📝
  - [ ] 回路接続の具体的仕様 📝
  - [ ] HULLマージ時のID処理
  - [x] COMPUTERのメモリ書き込み機構の仕様確定（外部書き換え許可プロパティ方式） 📝
  - [x] 外部ユニット連携の詳細（ユニット種別コード、コマンド仕様）
  - [x] メモリ書き込み機構の詳細（競合処理、一貫性保証）
  - [ ] 大きさ・形状の具体的仕様
- v4仕様 📝
  - [ ] v4系の達成目標を定義
  - [ ] 新ユニットタイプの検討（v4.0.0向け）
  - [ ] 物理演算システムの拡張検討（v4.0.0向け）
  - [ ] 通信プロトコルの定義（将来バージョン）

## 詳細

### v3仕様

- 本v3仕様の目的は、以下のコンセプトが動作するアプリケーションの仕様を作成することである
  - プログラム可能なエージェントが自己複製できる物理系
  - 複数の手法による自己複製および進化が可能
- このアプリケーションの目的は要素技術の検証であり、他人が使うことは想定しない

### DISASSEMBLERの（一時）廃止

- **現状**: game-world-requirement.mdにTBDとして記載
- **理由**: disassemble対象を指定できるようにするためにはCONNECTORが存在する方がシンプル
- **検討事項**:
  - 初期仕様からDISASSEMBLERを外す
  - v4でCONNECTORと共に実装する
  - 操作メモリ領域仕様が未定義のため実装が困難

#### v3アプリケーション仕様の検討事項

- ゲーム世界の仕様ではないためここでは検討しないが、アプリケーションとして実装する際に必要となる内容をここにメモする
- 内容
  - デバッグ・可視化機能の実装
  - パフォーマンス最適化（空間分割、メモリアクセス最適化）
  - バランス調整パラメータの設定
    - エネルギーソース密度
    - 熱拡散・放熱率
    - ユニットコスト係数
    - 等

### v4系の達成目標を定義

- v4仕様の目的は、他人に実際にアプリケーションを使ってもらうことによって、アプリケーション、仕様、ゲームデザインの改良点を発見することにある
- 他人に使ってもらう = 進化するエージェントを実装してもらう ために、それを実装する以下の動機を導入する
  - エージェントに自律行動の機能を付与する（MOVERおよびCONNECTORユニットの追加、DISASSEMBLERユニットの実用化）
  - エージェントに外界の情報を取得する機能を付与する（SENSORユニットの追加）
  - エージェント間で情報をやり取りする媒体を追加する
- それにより以下の生態を実現可能にする
  - 有性生殖
  - 多細胞化
  - 捕食
  - 寄生
  - 共生

### v4アプリケーション仕様の検討事項

- ゲーム世界の仕様ではないためここでは検討しないが、アプリケーションとして実装する際に必要となる内容をここにメモする
- 内容
  - エネルギー効率的なエージェント設計パターンの文書化
  - デバッグ用ツールの仕様検討
  - エージェント実装者向けのベストプラクティス集の作成
  - よくある質問（FAQ）の作成
  - 用語集の作成
  - 環境多様性の追加（地形、エネルギー密度勾配、情報フィールド）
  - 突然変異メカニズムの拡張
  - 生態的ニッチの創出メカニズム

### Synthetica C記法の検討する

- Synthetica ScriptへコンパイルするC言語の記法のうち、一般的なC言語の踏襲では実現できないものがあると思われる
- テンプレート記法は、 `goto` 命令のみであればラベルに特定の文言が含まれている場合にはテンプレート記法である、という解釈で良いが、ループや分岐、メソッド呼び出しなどは、一般的なC言語の記法では実現できないと思われる
- これらをどのように実現するか、一般的なC言語の記法で実現する方法があるか、なければどのように記述するか検討する

### 現在の時刻を取得する命令が必要か検討する

- tickが進んだことに依存する処理を実装したい、という要望はあると思われる（内蔵エネルギー量のチェック、v4で予定されているSENSORユニットの読み出し値チェック、等は同じtickで再度行っても意味がないため）
- しかし、そのように直接的に世界の情報を取得する命令はあまり実装したくない
  - tickのようなシステム根幹の情報を露出させずとも行う方法はあるのではないか。検討する

### エネルギー確保順序とアクション実行順序の決定

- **状態**: 未着手
- **詳細**: 複数ユニットが同時にエネルギーを要求する場合の処理順序が未定義
- **影響**: ゲームバランスと公平性に影響
- **関連ファイル**: `game-world-requirement.md`

### ビット演算を活用した効率的な実装方法の文書化

- **状態**: 未着手
- **詳細**: 1024進法エネルギー計算の効率的な実装例が不足
- **影響**: 実装者の参考資料
- **関連ファイル**: `agent-code/v3.0.0/synthetica-c-compiler.md`

### エネルギーソースの実装仕様

- **状態**: 未着手
- **詳細**: エネルギーソースの詳細な動作仕様が未定義
- **影響**: ゲームプレイの核心機能
- **関連ファイル**: `game-world-requirement.md`

### 熱拡散システムの詳細定義

- **状態**: 未着手
- **詳細**: 熱の発生・拡散・減衰の具体的な計算式が未定義
- **影響**: 環境相互作用の重要要素
- **関連ファイル**: `game-world-requirement.md`

### 移動システムの実装詳細

- **状態**: 未着手
- **詳細**: MOVERユニットの具体的な動作仕様が不完全
- **影響**: エージェントの移動機能
- **関連ファイル**: `game-world-requirement.md`

### v3.0.0準拠の自己複製エージェント実装例の作成

- **状態**: 完了
- **詳細**: 新しい命令セットを活用した効率的な自己複製エージェントの実装例を作成する。また、別の自己複製実装について検討することでSynthetica Scriptの仕様の不足を洗い出す。
  - 以下の3種類の異なる自己複製処理をもつエージェントを実装する
    - プログラム的に娘個体を定義（参考: `v3.0.0以前/example.c` ）
      - constructor-based replication
    - メモリ上に格納したスペックを元に複製（万能複製
      - blueprint replication
    - 自己のスペックをスキャンして複製
      - self-scanning replication
- **関連ファイル**: `agent-code/v3.0.0/`

### v3.1.0準拠の自己複製エージェント実装例の作成

- **状態**: 未着手
- **詳細**: v3.1.0で追加された新命令（ビットシフト、スタック操作、条件付き実行、動的ユニット操作）を活用して、より効率的で洗練された自己複製エージェントの実装例を作成する。
  - v3.0.0の実装を改良し、以下の点を改善する
    - ビットシフト命令による16bit値の効率的な組み立て
    - スタック操作による関数化とモジュール化
    - 条件付き実行による分岐の削減
    - 動的ユニット操作によるループ処理の簡略化
  - 新たな自己複製パターンの探索
    - メモリ管理を考慮した実装
    - エラーハンドリングの強化
- **関連ファイル**: `agent-code/v3.1.0/`

### 物理演算の詳細仕様化（衝突・反発力）

- **提案内容**:
  - オブジェクト形状: 円形を基本とする
  - 反発力計算式: `F = k × overlap × (m1 × m2)/(m1 + m2)`
    - k: 反発係数（設定可能）
    - overlap: 重なり量
    - m1, m2: 各オブジェクトの質量
  - 摩擦係数: 0.1（速度に比例した減衰）

### エネルギーオブジェクトの物理仕様

- **提案内容**:
  - 単位サイズ: 1E = 1単位体積
  - 結合ルール: 同一座標の複数エネルギーは自動的に結合
  - 分割ルール: DISASSEMBLERによってのみ分割可能
  - 慣性: 通常のゲームオブジェクトと同様（質量=エネルギー量）

### 回路接続の具体的仕様

- **提案内容**:
  - 物理的接続: ユニット同士が固定された状態
  - 回路的接続: 物理的接続 + 接続許可フラグ
  - 接続上限: 各ユニット最大16接続
  - 接続確立: 双方の同意が必要

### COMPUTERのメモリ書き込み機構の仕様確定（外部書き換え許可プロパティ方式）

- **現状**: 暫定採用案あり
- **暫定案の内容**:
  - COMPUTERに「外部からのメモリ書き換え許可/拒否」プロパティを追加
  - 生成時は「許可」状態で生成
  - 生成後に親COMPUTERがメモリ書き込み
  - 処理を子COMPUTERへ引き継ぎ（詳細はSynthetica Script仕様に依存）
- **要検討事項**:
  - Synthetica Script仕様策定後に最終決定
  - 外部書き換え許可状態でのセキュリティリスクの評価
  - メモリ書き込み中のエラーハンドリング
  - 同時複数COMPUTER生成時の競合処理

## 完了項目のアーカイブ

完了した項目は、完了日とともに以下に記録し、定期的に`done/`ディレクトリへ移動します。

### 2025-07-31 完了

- [x] 万能複製実現のための追加命令の実装（advanced-instructions-proposal.md参照）
- [x] v3.0.0準拠の自己複製エージェント実装例の作成
- [x] ビットシフト命令（SHL, SHR, SAR）の追加
- [x] スタック操作命令（PUSH/POP）の追加
- [x] 条件付き実行命令（CMOV）の追加
- [x] 動的ユニット操作命令（UNIT_MEM_WRITE_DYN）の追加
- [x] メモリ管理のベストプラクティス文書作成
- [x] スタック保護の実装例作成

### 2025-07-28 完了

- [x] エネルギースケール変更（1024進法への移行）
- [x] 16bitアーキテクチャへの移行
- [x] レジスタベース・間接アドレッシング命令の追加
- [x] UNIT_EXISTS命令の追加
- [x] エネルギー計算専用命令の追加
- [x] セマンティックバージョニングの導入（v3.0.0）
- [x] COMPUTERのメモリ書き込み機構の仕様確定（外部書き換え許可プロパティ方式）
- [x] 外部ユニット連携の詳細（ユニット種別コード、コマンド仕様）
- [x] メモリ書き込み機構の詳細（競合処理、一貫性保証）

## 更新履歴

- 2025-07-31: v3.1.0準拠の自己複製エージェント実装例を追加、完了項目を更新
- 2025-07-28: ファイル作成、初期項目の整理
